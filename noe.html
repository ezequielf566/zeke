<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>A Saga de José</title>
    <style>
        :root { --gold: #f1c40f; --neon-green: #2ecc71; --red: #ff4757; }
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            overflow: hidden; background: #000; font-family: 'Georgia', serif;
            user-select: none; -webkit-user-select: none; touch-action: none; 
        }
        #game-container {
            width: 100vw; height: 100vh;
            background: url('fundo.jpg') center/cover no-repeat;
            position: relative; overflow: hidden;
            display: none;
        }
        
        /* MENU */
        #main-menu {
            width: 100vw; height: 100vh;
            background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('fundo.jpg') center/cover;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            position: absolute; z-index: 500; text-align: center;
        }
        .menu-btn {
            padding: 15px; border-radius: 50px; border: 2px solid var(--gold);
            background: rgba(0,0,0,0.8); color: white; font-weight: bold; cursor: pointer;
            margin: 5px; width: 200px; font-size: 16px;
        }

        /* UI */
        #ui-header { position: absolute; top: 10px; width: 100%; display: flex; flex-direction: column; align-items: center; z-index: 100; pointer-events: none; }
        #hud { width: 90%; display: flex; justify-content: space-between; pointer-events: none; }
        .hud-item { background: rgba(0,0,0,0.7); padding: 5px 15px; border-radius: 8px; color: white; border: 1px solid var(--gold); }
        
        #pause-btn {
            position: absolute; top: 70px; right: 20px; width: 50px; height: 50px;
            background: rgba(0,0,0,0.7); border: 2px solid white; color: white;
            border-radius: 50%; font-weight: bold; cursor: pointer; z-index: 110;
        }

        #progress-wrapper { width: 80%; height: 10px; background: rgba(0,0,0,0.5); border-radius: 10px; margin-top: 10px; position: relative; }
        #progress-fill { height: 100%; width: 0%; background: var(--gold); border-radius: 10px; }

        #player { width: 100px; height: 100px; position: absolute; bottom: 120px; left: 10%; z-index: 50; }
        #chao { position: absolute; bottom: 0; width: 100%; height: 120px; background: linear-gradient(to bottom, #1e3d1a, #2c1e14); z-index: 10; }

        .rock-glow { filter: drop-shadow(0 0 15px var(--gold)); background: var(--gold) !important; }
        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: none; justify-content: center; align-items: center; flex-direction: column; z-index: 1000; background: rgba(0,0,0,0.8); color: white; }
    </style>
</head>
<body onmousedown="handleInput(event)" ontouchstart="handleInput(event)">

<div id="main-menu">
    <h1 style="color: var(--gold);">A SAGA DE JOSÉ</h1>
    <button class="menu-btn" onclick="startGame('jornada', 'normal')">NORMAL</button>
    <button class="menu-btn" onclick="startGame('jornada', 'dificil')">DIFÍCIL</button>
    <button class="menu-btn" style="border-color: var(--neon-green)" onclick="startGame('sobrevivencia')">SOBREVIVÊNCIA</button>
</div>

<div id="game-container">
    <button id="pause-btn" onclick="event.stopPropagation(); togglePause();">||</button>
    
    <div id="ui-header">
        <div id="hud">
            <div id="vidas">❤❤❤</div>
            <div id="score-live">0</div>
            <div id="timer">00:00</div>
        </div>
        <div id="progress-wrapper"><div id="progress-fill"></div></div>
    </div>

    <div id="player"><img src="animal.gif" style="width:100%; pointer-events: none;"></div>
    <div id="chao"></div>

    <div id="lose-screen" class="overlay">
        <h1 style="color: var(--red);">FIM DE JOGO</h1>
        <button class="menu-btn" onclick="location.reload()">RECOMEÇAR</button>
    </div>
</div>

<script>
    const player = document.getElementById('player'), container = document.getElementById('game-container');
    let gameActive = false, isPaused = false, vidas = 3, score = 0;
    let playerY = 0, velocityY = 0, jumps = 0, gravity = 1.1; // Gravidade original
    let currentSpeed = 10, timeElapsed = 0;

    function startGame(mode, diff) {
        event.stopPropagation();
        document.getElementById('main-menu').style.display = 'none';
        container.style.display = 'block';
        gameActive = true;
        if(diff === 'dificil') currentSpeed = 15;
        
        requestAnimationFrame(update);
        spawnObstacle();
        
        setInterval(() => {
            if(gameActive && !isPaused) {
                timeElapsed++;
                score += 10;
                document.getElementById('score-live').innerText = score;
                let p = (timeElapsed / 150) * 100;
                document.getElementById('progress-fill').style.width = p + "%";
                currentSpeed += 0.03;
            }
        }, 1000);
    }

    function handleInput(e) {
        // Se clicar em botão, não pula
        if (e.target.tagName === 'BUTTON') return;
        if (gameActive && !isPaused && jumps < 2) {
            velocityY = 18; // Força do pulo
            jumps++;
        }
    }

    function togglePause() {
        isPaused = !isPaused;
        document.getElementById('pause-btn').innerText = isPaused ? "▶" : "||";
    }

    function update() {
        if(!gameActive) return;
        if(!isPaused) {
            playerY += velocityY;
            velocityY -= gravity;

            if(playerY <= 0) {
                playerY = 0;
                velocityY = 0;
                jumps = 0;
            }
            player.style.bottom = (120 + playerY) + "px";
        }
        requestAnimationFrame(update);
    }

    function spawnObstacle() {
        if(!gameActive) return;
        if(!isPaused) {
            const rock = document.createElement('div');
            rock.style.cssText = `position:absolute; bottom:120px; width:45px; height:45px; background:#444; border-radius:8px; right:-50px;`;
            container.appendChild(rock);

            let pos = -50;
            let move = setInterval(() => {
                if(!gameActive) { rock.remove(); clearInterval(move); return; }
                if(!isPaused) {
                    pos += currentSpeed;
                    rock.style.right = pos + "px";

                    let pR = player.getBoundingClientRect(), rR = rock.getBoundingClientRect();
                    // Colisão precisa
                    if(pR.left < rR.right - 10 && pR.right > rR.left + 10 && pR.bottom > rR.top + 10) {
                        vidas--;
                        document.getElementById('vidas').innerText = "❤".repeat(vidas);
                        rock.remove(); clearInterval(move);
                        if(vidas <= 0) { gameActive = false; document.getElementById('lose-screen').style.display = 'flex'; }
                    }
                    if(pos > window.innerWidth + 50) { rock.remove(); clearInterval(move); }
                }
            }, 16);
        }
        setTimeout(spawnObstacle, 1000 + Math.random() * 1000);
    }

    window.addEventListener('keydown', (e) => {
        if(e.code === 'Space' || e.code === 'Enter' || e.code === 'ArrowUp') {
            handleInput(e);
        }
    });
</script>
</body>
</html>
