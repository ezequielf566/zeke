<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>O Templo Sagrado: A Oferta de Davi</title>

<style>
:root {
    --gold-main:#FFD700;
    --gold-dark:#B8860B;
}

*{margin:0;padding:0;box-sizing:border-box;touch-action:none}

body{
    background:#111;
    font-family:Georgia,serif;
    overflow:hidden;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
}

#game-wrapper{
    position:relative;
    width:100vw;
    height:100vh;
    max-width:520px;
    background:url('manafundo.png') center/cover no-repeat;
    overflow:hidden;
}

/* CAMADAS VISUAIS (ZERO CUSTO CPU) */
#fog{
    position:absolute;inset:0;
    background:radial-gradient(circle,rgba(255,255,255,.15),rgba(0,0,0,.65));
    opacity:0;transition:opacity 2s;
    pointer-events:none;z-index:40;
}
.fog-active #fog{opacity:1}

.lightning{
    position:absolute;inset:0;
    background:white;
    opacity:0;
    animation:lightning 7s infinite;
    pointer-events:none;z-index:60;
}
@keyframes lightning{
    0%,94%{opacity:0}
    95%{opacity:.8}
    100%{opacity:0}
}

.night-mode{filter:brightness(.45) saturate(.6)}

canvas{position:absolute;inset:0}

.ui-panel{
    position:absolute;top:15px;width:100%;
    text-align:center;z-index:100;pointer-events:none;
}

#score-card{
    display:inline-block;
    background:rgba(0,0,0,.85);
    color:var(--gold-main);
    padding:8px 22px;
    border-radius:10px;
    border:2px solid var(--gold-main);
    font-size:1.7rem;
}

#feedback{
    position:absolute;top:40%;width:100%;
    text-align:center;font-size:2rem;
    font-weight:bold;color:#fff;
    display:none;z-index:120;
}

#overlay{
    position:absolute;inset:0;
    background:rgba(0,0,0,.92);
    display:flex;flex-direction:column;
    justify-content:center;align-items:center;
    color:#fff;text-align:center;z-index:200;
}

button{
    margin-top:25px;
    padding:16px 45px;
    border-radius:50px;
    border:none;
    font-size:1.4rem;
    font-weight:bold;
    background:linear-gradient(#FFD700,#B8860B);
    color:#3e2723;
}
</style>
</head>

<body>

<div id="game-wrapper">
    <canvas id="canvas"></canvas>
    <div id="fog"></div>
    <div class="lightning"></div>

    <div id="feedback">PERFEITO!</div>

    <div class="ui-panel">
        <div id="score-card">
            <div id="level-tag" style="font-size:.7rem;color:#fff">DIA CLARO</div>
            <span id="score">0</span>
        </div>
    </div>

    <div id="overlay">
        <h1 style="color:var(--gold-main)">TEMPLO SAGRADO</h1>
        <p>Erga a obra enfrentando a natureza.</p>
        <button onclick="Game.start()">INICIAR</button>
    </div>
</div>

<script>
const DPR = Math.min(2, window.devicePixelRatio || 1);

const Game = {
canvas:document.getElementById('canvas'),
ctx:null,
wrapper:document.getElementById('game-wrapper'),

width:0,height:0,
cameraY:0,targetCameraY:0,

blocks:[],fallingBlock:null,
particles:[],

score:0,
gameActive:false,
exploding:false,

wind:0,rain:false,
towerLean:0,leanV:0,

blockW:130,blockH:42,

swing:{angle:0,speed:.012,amp:.45,x:0,y:0},

init(){
    this.ctx=this.canvas.getContext('2d',{alpha:false});
    this.resize();
    window.addEventListener('resize',()=>this.resize());
    this.canvas.addEventListener('pointerdown',()=>this.launch());
    requestAnimationFrame(()=>this.loop());
},

resize(){
    this.width=this.canvas.offsetWidth;
    this.height=this.canvas.offsetHeight;
    this.canvas.width=this.width*DPR;
    this.canvas.height=this.height*DPR;
    this.ctx.setTransform(DPR,0,0,DPR,0,0);
},

start(){
    this.score=0;
    this.blocks=[{x:this.width/2-65,y:this.height-120,fixed:true}];
    this.cameraY=0;this.targetCameraY=0;
    this.fallingBlock=null;
    this.gameActive=true;
    this.exploding=false;
    this.wrapper.className='';
    document.getElementById('overlay').style.display='none';
    document.getElementById('score').innerText=0;
},

launch(){
    if(!this.gameActive||this.fallingBlock)return;
    this.fallingBlock={
        x:this.swing.x-this.blockW/2,
        y:this.swing.y+this.blockH,
        vy:0,vx:this.wind*280,gravity:1.05
    };
},

updateDifficulty(){
    const tag=document.getElementById('level-tag');

    if(this.score>=50){this.wind=.006;tag.innerText="VENTOS"}
    if(this.score>=100){this.rain=true;this.spawn('leaf',120);tag.innerText="TEMPESTADE"}
    if(this.score>=190){this.wrapper.classList.add('night-mode');tag.innerText="NOITE"}
    if(this.score>=300){this.wrapper.classList.add('fog-active');tag.innerText="NEBLINA"}
},

spawn(type,amount){
    for(let i=0;i<amount;i++){
        if(this.particles.length>120)break;
        this.particles.push({
            x:Math.random()*this.width,
            y:-this.cameraY+Math.random()*this.height,
            vx:(Math.random()-.5)*2,
            vy:Math.random()*3+1,
            life:100+Math.random()*60,
            type
        });
    }
},

loop(){
    const c=this.ctx;
    c.clearRect(0,0,this.width,this.height);

    if(!this.exploding)
        this.cameraY+=(this.targetCameraY-this.cameraY)*.08;

    if(this.gameActive&&!this.fallingBlock){
        this.swing.angle+=this.swing.speed+Math.sin(Date.now()*0.002)*this.wind;
        this.swing.x=this.width/2+Math.sin(this.swing.angle)*(this.width*this.swing.amp);
        this.swing.y=-this.cameraY+120;
    }

    c.save();
    c.translate(0,this.cameraY);

    this.blocks.forEach(b=>{
        c.fillStyle="gold";
        c.fillRect(b.x,b.y,this.blockW,this.blockH);
    });

    if(this.fallingBlock){
        this.fallingBlock.vy+=this.fallingBlock.gravity;
        this.fallingBlock.x+=this.fallingBlock.vx;
        this.fallingBlock.y+=this.fallingBlock.vy;
        c.fillRect(this.fallingBlock.x,this.fallingBlock.y,this.blockW,this.blockH);
        if(this.fallingBlock.y>=this.blocks.at(-1).y-this.blockH){
            this.blocks.push({x:this.fallingBlock.x,y:this.blocks.at(-1).y-this.blockH});
            this.score+=5;
            this.targetCameraY+=this.blockH;
            document.getElementById('score').innerText=this.score;
            this.updateDifficulty();
            this.fallingBlock=null;
        }
    }

    if(this.gameActive&&!this.fallingBlock){
        c.strokeStyle="gold";c.lineWidth=2;
        c.beginPath();
        c.moveTo(this.width/2,-200);
        c.lineTo(this.swing.x,this.swing.y);
        c.stroke();
        c.shadowBlur=this.wrapper.classList.contains('night-mode')?20:0;
        c.shadowColor="rgba(255,215,120,.9)";
        c.fillRect(this.swing.x-this.blockW/2,this.swing.y,this.blockW,this.blockH);
        c.shadowBlur=0;
    }

    c.restore();

    this.particles=this.particles.filter(p=>p.life-- >0);
    requestAnimationFrame(()=>this.loop());
}
};

Game.init();
</script>
</body>
</html>
